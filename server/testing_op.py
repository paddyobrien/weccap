import numpy as np
from helpers import locate_objects, find_point_correspondance_and_object_points, camera_poses_to_projection_matrices

camera_poses = [{"R":[[1,0,0],[0,1,0],[0,0,1]],"t":[0,0,0]},{"R":[[-0.019481010588984604,0.5862511379900401,-0.8098951126113891],[-0.6014000756404223,0.6402462493929415,0.4779149392496175],[0.7987104852486451,0.49638124797745353,0.3400988347675123]],"t":[0.1869990587965771,-0.11394996288671215,0.15266653337583094]},{"R":[[-0.9982896781772183,-0.04977323662642176,0.030665018515512007],[0.013789737146191416,0.309254207941227,0.9508794234917926],[-0.05681163256117021,0.9496759762078721,-0.30803892387060444]],"t":[-0.003815571562521906,-0.21980806674081818,0.3136762696592219]},{"R":[[0.10059491378569024,-0.6499412307584526,0.753297457768601],[0.6643576500391776,0.6074864699239377,0.4354183065671148],[-0.7406143234875159,0.4566580618138043,0.49290347779822835]],"t":[-0.19817059283083918,-0.12037193990265409,0.1270565752910307]}]
problem_image_points = [
    [[197, 238], [126, 174]], 
    [[135, 229], [207, 169]], 
    [[202, 216], [133, 161]], 
    [[79, 202], [155, 147]]
]

print("Computing bad result")
_, bad_object_points, _ = find_point_correspondance_and_object_points(problem_image_points, camera_poses, camera_poses_to_projection_matrices(camera_poses))



bad_result = [
    [
        [[197, 238], [207, 169], [133, 161], [79, 202]],
        [[197, 238], [135, 229], [133, 161], [79, 202]]
    ],[
        [[126, 174], [207, 169], [202, 216], [155, 147]], 
        [[126, 174], [135, 229], [202, 216], [155, 147]]
    ],[
        [[None, None], [135, 229], [202, 216], [155, 147]]
    ]]

good_image_points = [
    [[120, 200], [224, 196]],
    [[173, 231], [166, 149]],
    [[101, 190], [200, 189]], 
    [[126, 229], [125, 147]]
]

print("Computing good result")
_, good_object_points, _ = find_point_correspondance_and_object_points(good_image_points, camera_poses, camera_poses_to_projection_matrices(camera_poses))

print(good_object_points)

good_result = [
    [
        [[120, 200], [173, 231], [200, 189], [125, 147]]
    ], [
        [[224, 196], [166, 149], [101, 190], [126, 229]]
    ]]